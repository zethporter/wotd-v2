import{r as X}from"./main-Bw80k_GK.js";var Ce={},le={};const H=Object.create(null),F=e=>Ce||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?H:globalThis),E=new Proxy(H,{get(e,t){return F()[t]??H[t]},has(e,t){return t in F()||t in H},set(e,t,n){const r=F(!0);return r[t]=n,!0},deleteProperty(e,t){if(!t)return!1;const n=F(!0);return delete n[t],!0},ownKeys(){const e=F(!0);return Object.keys(e)}});function m(e,t){return typeof process<"u"&&le?le[e]??t:typeof Deno<"u"?Deno.env.get(e)??t:typeof Bun<"u"?Bun.env[e]??t:t}const k=1,y=4,L=8,S=24,ue={eterm:y,cons25:y,console:y,cygwin:y,dtterm:y,gnome:y,hurd:y,jfbterm:y,konsole:y,kterm:y,mlterm:y,mosh:S,putty:y,st:y,"rxvt-unicode-24bit":S,terminator:S,"xterm-kitty":S},Ue=new Map(Object.entries({APPVEYOR:L,BUILDKITE:L,CIRCLECI:S,DRONE:L,GITEA_ACTIONS:S,GITHUB_ACTIONS:S,GITLAB_CI:L,TRAVIS:L})),xe=[/ansi/,/color/,/linux/,/direct/,/^con[0-9]*x[0-9]/,/^rxvt/,/^screen/,/^xterm/,/^vt100/,/^vt220/];function Me(){if(m("FORCE_COLOR")!==void 0)switch(m("FORCE_COLOR")){case"":case"1":case"true":return y;case"2":return L;case"3":return S;default:return k}if(m("NODE_DISABLE_COLORS")!==void 0&&m("NODE_DISABLE_COLORS")!==""||m("NO_COLOR")!==void 0&&m("NO_COLOR")!==""||m("TERM")==="dumb")return k;if(m("TMUX"))return S;if("TF_BUILD"in E&&"AGENT_NAME"in E)return y;if("CI"in E){for(const{0:e,1:t}of Ue)if(e in E)return t;return m("CI_NAME")==="codeship"?L:k}if("TEAMCITY_VERSION"in E)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.exec(m("TEAMCITY_VERSION"))!==null?y:k;switch(m("TERM_PROGRAM")){case"iTerm.app":return!m("TERM_PROGRAM_VERSION")||/^[0-2]\./.exec(m("TERM_PROGRAM_VERSION"))!==null?L:S;case"HyperTerm":case"MacTerm":return S;case"Apple_Terminal":return L}if(m("COLORTERM")==="truecolor"||m("COLORTERM")==="24bit")return S;if(m("TERM")){if(/truecolor/.exec(m("TERM"))!==null)return S;if(/^xterm-256/.exec(m("TERM"))!==null)return L;const e=m("TERM").toLowerCase();if(ue[e])return ue[e];if(xe.some(t=>t.exec(e)!==null))return y}return m("COLORTERM")?y:k}const I={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",fg:{red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m"}},re=["debug","info","success","warn","error"];function Ne(e,t){return re.indexOf(t)>=re.indexOf(e)}const $e={info:I.fg.blue,success:I.fg.green,warn:I.fg.yellow,error:I.fg.red,debug:I.fg.magenta},Be=(e,t,n)=>{const r=new Date().toISOString();return n?`${I.dim}${r}${I.reset} ${$e[e]}${e.toUpperCase()}${I.reset} ${I.bright}[Better Auth]:${I.reset} ${t}`:`${r} ${e.toUpperCase()} [Better Auth]: ${t}`},qe=e=>{const t="error",n=Me()!==1,r=(s,a,o=[])=>{if(!Ne(t,s))return;const f=Be(s,a,n);{s==="error"?console.error(f,...o):s==="warn"?console.warn(f,...o):console.log(f,...o);return}};return{...Object.fromEntries(re.map(s=>[s,(...[a,...o])=>r(s,a,o)])),get level(){return t}}};qe();function Fe(e){return e.charAt(0).toUpperCase()+e.slice(1)}var j=class extends Error{constructor(e,t){super(e),this.name="BetterAuthError",this.message=e,this.cause=t,this.stack=""}};function ke(e){try{return(new URL(e).pathname.replace(/\/+$/,"")||"/")!=="/"}catch{throw new j(`Invalid base URL: ${e}. Please provide a valid base URL.`)}}function De(e){try{const t=new URL(e);if(t.protocol!=="http:"&&t.protocol!=="https:")throw new j(`Invalid base URL: ${e}. URL must include 'http://' or 'https://'`)}catch(t){throw t instanceof j?t:new j(`Invalid base URL: ${e}. Please provide a valid base URL.`,String(t))}}function Q(e,t="/api/auth"){if(De(e),ke(e))return e;const n=e.replace(/\/+$/,"");return!t||t==="/"?n:(t=t.startsWith("/")?t:`/${t}`,`${n}${t}`)}function je(e,t,n,r,s){if(e)return Q(e,t);{const a=E.BETTER_AUTH_URL||E.NEXT_PUBLIC_BETTER_AUTH_URL||E.PUBLIC_BETTER_AUTH_URL||E.NUXT_PUBLIC_BETTER_AUTH_URL||E.NUXT_PUBLIC_AUTH_URL||(E.BASE_URL!=="/"?E.BASE_URL:void 0);if(a)return Q(a,t)}if(typeof window<"u"&&window.location)return Q(window.location.origin,t)}const ze={id:"redirect",name:"Redirect",hooks:{onSuccess(e){if(e.data?.url&&e.data?.redirect&&typeof window<"u"&&window.location&&window.location)try{window.location.href=e.data.url}catch{}}}},Ge={proto:/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,constructor:/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,protoShort:/"__proto__"\s*:/,constructorShort:/"constructor"\s*:/},Ve=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/,fe={true:!0,false:!1,null:null,undefined:void 0,nan:NaN,infinity:Number.POSITIVE_INFINITY,"-infinity":Number.NEGATIVE_INFINITY},We=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d{1,7}))?(?:Z|([+-])(\d{2}):(\d{2}))$/;function He(e){return e instanceof Date&&!isNaN(e.getTime())}function Je(e){const t=We.exec(e);if(!t)return null;const[,n,r,s,a,o,f,i,l,c,d]=t;let h=new Date(Date.UTC(parseInt(n,10),parseInt(r,10)-1,parseInt(s,10),parseInt(a,10),parseInt(o,10),parseInt(f,10),i?parseInt(i.padEnd(3,"0"),10):0));if(l){const v=(parseInt(c,10)*60+parseInt(d,10))*(l==="+"?-1:1);h.setUTCMinutes(h.getUTCMinutes()+v)}return He(h)?h:null}function Ye(e,t={}){const{strict:n=!1,warnings:r=!1,reviver:s,parseDates:a=!0}=t;if(typeof e!="string")return e;const o=e.trim();if(o.length>0&&o[0]==='"'&&o.endsWith('"')&&!o.slice(1,-1).includes('"'))return o.slice(1,-1);const f=o.toLowerCase();if(f.length<=9&&f in fe)return fe[f];if(!Ve.test(o)){if(n)throw new SyntaxError("[better-json] Invalid JSON");return e}if(Object.entries(Ge).some(([i,l])=>{const c=l.test(o);return c&&r&&console.warn(`[better-json] Detected potential prototype pollution attempt using ${i} pattern`),c})&&n)throw new Error("[better-json] Potential prototype pollution attempt detected");try{return JSON.parse(o,(l,c)=>{if(l==="__proto__"||l==="constructor"&&c&&typeof c=="object"&&"prototype"in c){r&&console.warn(`[better-json] Dropping "${l}" key to prevent prototype pollution`);return}if(a&&typeof c=="string"){const d=Je(c);if(d)return d}return s?s(l,c):c})}catch(i){if(n)throw i;return e}}function Xe(e,t={strict:!0}){return Ye(e,t)}let T=[],N=0;const G=4,q=e=>{let t=[],n={get(){return n.lc||n.listen(()=>{})(),n.value},lc:0,listen(r){return n.lc=t.push(r),()=>{for(let a=N+G;a<T.length;)T[a]===r?T.splice(a,G):a+=G;let s=t.indexOf(r);~s&&(t.splice(s,1),--n.lc||n.off())}},notify(r,s){let a=!T.length;for(let o of t)T.push(o,n.value,r,s);if(a){for(N=0;N<T.length;N+=G)T[N](T[N+1],T[N+2],T[N+3]);T.length=0}},off(){},set(r){let s=n.value;s!==r&&(n.value=r,n.notify(s))},subscribe(r){let s=n.listen(r);return r(n.value),s},value:e};return n},Qe=5,V=6,W=10;let Ze=(e,t,n,r)=>(e.events=e.events||{},e.events[n+W]||(e.events[n+W]=r(s=>{e.events[n].reduceRight((a,o)=>(o(a),a),{shared:{},...s})})),e.events[n]=e.events[n]||[],e.events[n].push(t),()=>{let s=e.events[n],a=s.indexOf(t);s.splice(a,1),s.length||(delete e.events[n],e.events[n+W](),delete e.events[n+W])}),Ke=1e3,ve=(e,t)=>Ze(e,r=>{let s=t(r);s&&e.events[V].push(s)},Qe,r=>{let s=e.listen;e.listen=(...o)=>(!e.lc&&!e.active&&(e.active=!0,r()),s(...o));let a=e.off;return e.events[V]=[],e.off=()=>{a(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let o of e.events[V])o();e.events[V]=[]}},Ke)},()=>{e.listen=s,e.off=a}});function et(e,t,n){let r=new Set(t).add(void 0);return e.listen((s,a,o)=>{r.has(o)&&n(s,a,o)})}const tt=()=>typeof window>"u",D=(e,t,n,r)=>{const s=q({data:null,error:null,isPending:!0,isRefetching:!1,refetch:f=>a(f)}),a=async f=>new Promise(i=>{const l=typeof r=="function"?r({data:s.get().data,error:s.get().error,isPending:s.get().isPending}):r;n(t,{...l,query:{...l?.query,...f?.query},async onSuccess(c){s.set({data:c.data,error:null,isPending:!1,isRefetching:!1,refetch:s.value.refetch}),await l?.onSuccess?.(c)},async onError(c){const{request:d}=c,h=typeof d.retry=="number"?d.retry:d.retry?.attempts,v=d.retryAttempt||0;h&&v<h||(s.set({error:c.error,data:null,isPending:!1,isRefetching:!1,refetch:s.value.refetch}),await l?.onError?.(c))},async onRequest(c){const d=s.get();s.set({isPending:d.data===null,data:d.data,error:null,isRefetching:!0,refetch:s.value.refetch}),await l?.onRequest?.(c)}}).catch(c=>{s.set({error:c,data:null,isPending:!1,isRefetching:!1,refetch:s.value.refetch})}).finally(()=>{i(void 0)})});e=Array.isArray(e)?e:[e];let o=!1;for(const f of e)f.subscribe(async()=>{tt()||(o?await a():ve(s,()=>{const i=setTimeout(async()=>{o||(await a(),o=!0)},0);return()=>{s.off(),f.off(),clearTimeout(i)}}))});return s},Z=Symbol.for("better-auth:broadcast-channel"),nt=()=>Math.floor(Date.now()/1e3);var rt=class{listeners=new Set;name;constructor(e="better-auth.message"){this.name=e}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}post(e){if(!(typeof window>"u"))try{localStorage.setItem(this.name,JSON.stringify({...e,timestamp:nt()}))}catch{}}setup(){if(typeof window>"u"||typeof window.addEventListener>"u")return()=>{};const e=t=>{if(t.key!==this.name)return;const n=JSON.parse(t.newValue??"{}");n?.event!=="session"||!n?.data||this.listeners.forEach(r=>r(n))};return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}}};function K(e="better-auth.message"){return globalThis[Z]||(globalThis[Z]=new rt(e)),globalThis[Z]}const ee=Symbol.for("better-auth:focus-manager");var st=class{listeners=new Set;subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}setFocused(e){this.listeners.forEach(t=>t(e))}setup(){if(typeof window>"u"||typeof document>"u"||typeof window.addEventListener>"u")return()=>{};const e=()=>{document.visibilityState==="visible"&&this.setFocused(!0)};return document.addEventListener("visibilitychange",e,!1),()=>{document.removeEventListener("visibilitychange",e,!1)}}};function de(){return globalThis[ee]||(globalThis[ee]=new st),globalThis[ee]}const te=Symbol.for("better-auth:online-manager");var ot=class{listeners=new Set;isOnline=typeof navigator<"u"?navigator.onLine:!0;subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}setOnline(e){this.isOnline=e,this.listeners.forEach(t=>t(e))}setup(){if(typeof window>"u"||typeof window.addEventListener>"u")return()=>{};const e=()=>this.setOnline(!0),t=()=>this.setOnline(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",t,!1),()=>{window.removeEventListener("online",e,!1),window.removeEventListener("offline",t,!1)}}};function ne(){return globalThis[te]||(globalThis[te]=new ot),globalThis[te]}const B=()=>Math.floor(Date.now()/1e3),it=5;function at(e){const{sessionAtom:t,sessionSignal:n,$fetch:r,options:s={}}=e,a=s.sessionOptions?.refetchInterval??0,o=s.sessionOptions?.refetchOnWindowFocus??!0,f=s.sessionOptions?.refetchWhenOffline??!1,i={lastSync:0,lastSessionRequest:0,cachedSession:void 0},l=()=>f||ne().isOnline,c=p=>{if(!l())return;if(p?.event==="storage"){i.lastSync=B(),n.set(!n.get());return}const R=t.get();if(p?.event==="poll"){i.lastSessionRequest=B(),r("/get-session").then(u=>{t.set({...R,data:u.data,error:u.error||null}),i.lastSync=B(),n.set(!n.get())}).catch(()=>{});return}p?.event==="visibilitychange"&&B()-i.lastSessionRequest<it&&R?.data!==null&&R?.data!==void 0||(R?.data===null||R?.data===void 0||p?.event==="visibilitychange")&&(p?.event==="visibilitychange"&&(i.lastSessionRequest=B()),i.lastSync=B(),n.set(!n.get()))},d=p=>{K().post({event:"session",data:{trigger:p},clientId:Math.random().toString(36).substring(7)})},h=()=>{a&&a>0&&(i.pollInterval=setInterval(()=>{t.get()?.data&&c({event:"poll"})},a*1e3))},v=()=>{i.unsubscribeBroadcast=K().subscribe(()=>{c({event:"storage"})})},O=()=>{o&&(i.unsubscribeFocus=de().subscribe(()=>{c({event:"visibilitychange"})}))},x=()=>{i.unsubscribeOnline=ne().subscribe(p=>{p&&c({event:"visibilitychange"})})};return{init:()=>{h(),v(),O(),x(),K().setup(),de().setup(),ne().setup()},cleanup:()=>{i.pollInterval&&(clearInterval(i.pollInterval),i.pollInterval=void 0),i.unsubscribeBroadcast&&(i.unsubscribeBroadcast(),i.unsubscribeBroadcast=void 0),i.unsubscribeFocus&&(i.unsubscribeFocus(),i.unsubscribeFocus=void 0),i.unsubscribeOnline&&(i.unsubscribeOnline(),i.unsubscribeOnline=void 0),i.lastSync=0,i.lastSessionRequest=0,i.cachedSession=void 0},triggerRefetch:c,broadcastSessionUpdate:d}}function ct(e,t){const n=q(!1),r=D(n,"/get-session",e,{method:"GET"});return ve(r,()=>{const s=at({sessionAtom:r,sessionSignal:n,$fetch:e,options:t});return s.init(),()=>{s.cleanup()}}),{session:r,$sessionSignal:n}}var lt=Object.defineProperty,ut=Object.defineProperties,ft=Object.getOwnPropertyDescriptors,he=Object.getOwnPropertySymbols,dt=Object.prototype.hasOwnProperty,ht=Object.prototype.propertyIsEnumerable,ge=(e,t,n)=>t in e?lt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,P=(e,t)=>{for(var n in t||(t={}))dt.call(t,n)&&ge(e,n,t[n]);if(he)for(var n of he(t))ht.call(t,n)&&ge(e,n,t[n]);return e},A=(e,t)=>ut(e,ft(t)),gt=class extends Error{constructor(e,t,n){super(t||e.toString(),{cause:n}),this.status=e,this.statusText=t,this.error=n,Error.captureStackTrace(this,this.constructor)}},mt=async(e,t)=>{var n,r,s,a,o,f;let i=t||{};const l={onRequest:[t?.onRequest],onResponse:[t?.onResponse],onSuccess:[t?.onSuccess],onError:[t?.onError],onRetry:[t?.onRetry]};if(!t||!t?.plugins)return{url:e,options:i,hooks:l};for(const c of t?.plugins||[]){if(c.init){const d=await((n=c.init)==null?void 0:n.call(c,e.toString(),t));i=d.options||i,e=d.url}l.onRequest.push((r=c.hooks)==null?void 0:r.onRequest),l.onResponse.push((s=c.hooks)==null?void 0:s.onResponse),l.onSuccess.push((a=c.hooks)==null?void 0:a.onSuccess),l.onError.push((o=c.hooks)==null?void 0:o.onError),l.onRetry.push((f=c.hooks)==null?void 0:f.onRetry)}return{url:e,options:i,hooks:l}},me=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(){return this.options.delay}},pt=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(e){return Math.min(this.options.maxDelay,this.options.baseDelay*2**e)}};function yt(e){if(typeof e=="number")return new me({type:"linear",attempts:e,delay:1e3});switch(e.type){case"linear":return new me(e);case"exponential":return new pt(e);default:throw new Error("Invalid retry strategy")}}var vt=async e=>{const t={},n=async r=>typeof r=="function"?await r():r;if(e?.auth){if(e.auth.type==="Bearer"){const r=await n(e.auth.token);if(!r)return t;t.authorization=`Bearer ${r}`}else if(e.auth.type==="Basic"){const[r,s]=await Promise.all([n(e.auth.username),n(e.auth.password)]);if(!r||!s)return t;t.authorization=`Basic ${btoa(`${r}:${s}`)}`}else if(e.auth.type==="Custom"){const[r,s]=await Promise.all([n(e.auth.prefix),n(e.auth.value)]);if(!s)return t;t.authorization=`${r??""} ${s}`}}return t},bt=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function wt(e){const t=e.headers.get("content-type"),n=new Set(["image/svg","application/xml","application/xhtml","application/html"]);if(!t)return"json";const r=t.split(";").shift()||"";return bt.test(r)?"json":n.has(r)||r.startsWith("text/")?"text":"blob"}function Rt(e){try{return JSON.parse(e),!0}catch{return!1}}function se(e){if(e===void 0)return!1;const t=typeof e;return t==="string"||t==="number"||t==="boolean"||t===null?!0:t!=="object"?!1:Array.isArray(e)?!0:e.buffer?!1:e.constructor&&e.constructor.name==="Object"||typeof e.toJSON=="function"}function pe(e){try{return JSON.parse(e)}catch{return e}}function ye(e){return typeof e=="function"}function Ot(e){if(e?.customFetchImpl)return e.customFetchImpl;if(typeof globalThis<"u"&&ye(globalThis.fetch))return globalThis.fetch;if(typeof window<"u"&&ye(window.fetch))return window.fetch;throw new Error("No fetch implementation found")}async function St(e){const t=new Headers(e?.headers),n=await vt(e);for(const[r,s]of Object.entries(n||{}))t.set(r,s);if(!t.has("content-type")){const r=_t(e?.body);r&&t.set("content-type",r)}return t}function _t(e){return se(e)?"application/json":null}function Et(e){if(!e?.body)return null;const t=new Headers(e?.headers);if(se(e.body)&&!t.has("content-type")){for(const[n,r]of Object.entries(e?.body))r instanceof Date&&(e.body[n]=r.toISOString());return JSON.stringify(e.body)}return t.has("content-type")&&t.get("content-type")==="application/x-www-form-urlencoded"&&se(e.body)?new URLSearchParams(e.body).toString():e.body}function Tt(e,t){var n;if(t?.method)return t.method.toUpperCase();if(e.startsWith("@")){const r=(n=e.split("@")[1])==null?void 0:n.split("/")[0];return we.includes(r)?r.toUpperCase():t?.body?"POST":"GET"}return t?.body?"POST":"GET"}function Pt(e,t){let n;return!e?.signal&&e?.timeout&&(n=setTimeout(()=>t?.abort(),e?.timeout)),{abortTimeout:n,clearTimeout:()=>{n&&clearTimeout(n)}}}var At=class be extends Error{constructor(t,n){super(n||JSON.stringify(t,null,2)),this.issues=t,Object.setPrototypeOf(this,be.prototype)}};async function J(e,t){const n=await e["~standard"].validate(t);if(n.issues)throw new At(n.issues);return n.value}var we=["get","post","put","patch","delete"],Lt=e=>({id:"apply-schema",name:"Apply Schema",version:"1.0.0",async init(t,n){var r,s,a,o;const f=((s=(r=e.plugins)==null?void 0:r.find(i=>{var l;return(l=i.schema)!=null&&l.config?t.startsWith(i.schema.config.baseURL||"")||t.startsWith(i.schema.config.prefix||""):!1}))==null?void 0:s.schema)||e.schema;if(f){let i=t;(a=f.config)!=null&&a.prefix&&i.startsWith(f.config.prefix)&&(i=i.replace(f.config.prefix,""),f.config.baseURL&&(t=t.replace(f.config.prefix,f.config.baseURL))),(o=f.config)!=null&&o.baseURL&&i.startsWith(f.config.baseURL)&&(i=i.replace(f.config.baseURL,""));const l=f.schema[i];if(l){let c=A(P({},n),{method:l.method,output:l.output});return n?.disableValidation||(c=A(P({},c),{body:l.input?await J(l.input,n?.body):n?.body,params:l.params?await J(l.params,n?.params):n?.params,query:l.query?await J(l.query,n?.query):n?.query})),{url:t,options:c}}}return{url:t,options:n}}}),It=e=>{async function t(n,r){const s=A(P(P({},e),r),{plugins:[...e?.plugins||[],Lt(e||{}),...r?.plugins||[]]});if(e?.catchAllError)try{return await oe(n,s)}catch(a){return{data:null,error:{status:500,statusText:"Fetch Error",message:"Fetch related error. Captured by catchAllError option. See error property for more details.",error:a}}}return await oe(n,s)}return t};function Ct(e,t){const{baseURL:n,params:r,query:s}=t||{query:{},params:{},baseURL:""};let a=e.startsWith("http")?e.split("/").slice(0,3).join("/"):n||"";if(e.startsWith("@")){const d=e.toString().split("@")[1].split("/")[0];we.includes(d)&&(e=e.replace(`@${d}/`,"/"))}a.endsWith("/")||(a+="/");let[o,f]=e.replace(a,"").split("?");const i=new URLSearchParams(f);for(const[d,h]of Object.entries(s||{})){if(h==null)continue;let v;if(typeof h=="string")v=h;else if(Array.isArray(h)){for(const O of h)i.append(d,O);continue}else v=JSON.stringify(h);i.set(d,v)}if(r)if(Array.isArray(r)){const d=o.split("/").filter(h=>h.startsWith(":"));for(const[h,v]of d.entries()){const O=r[h];o=o.replace(v,O)}}else for(const[d,h]of Object.entries(r))o=o.replace(`:${d}`,String(h));o=o.split("/").map(encodeURIComponent).join("/"),o.startsWith("/")&&(o=o.slice(1));let l=i.toString();return l=l.length>0?`?${l}`.replace(/\+/g,"%20"):"",a.startsWith("http")?new URL(`${o}${l}`,a):`${a}${o}${l}`}var oe=async(e,t)=>{var n,r,s,a,o,f,i,l;const{hooks:c,url:d,options:h}=await mt(e,t),v=Ot(h),O=new AbortController,x=(n=h.signal)!=null?n:O.signal,w=Ct(d,h),M=Et(h),p=await St(h),R=Tt(d,h);let u=A(P({},h),{url:w,headers:p,body:M,method:R,signal:x});for(const _ of c.onRequest)if(_){const b=await _(u);typeof b=="object"&&b!==null&&(u=b)}("pipeTo"in u&&typeof u.pipeTo=="function"||typeof((r=t?.body)==null?void 0:r.pipe)=="function")&&("duplex"in u||(u.duplex="half"));const{clearTimeout:$}=Pt(h,O);let g=await v(u.url,u);$();const ae={response:g,request:u};for(const _ of c.onResponse)if(_){const b=await _(A(P({},ae),{response:(s=t?.hookOptions)!=null&&s.cloneResponse?g.clone():g}));b instanceof Response?g=b:typeof b=="object"&&b!==null&&(g=b.response)}if(g.ok){if(!(u.method!=="HEAD"))return{data:"",error:null};const b=wt(g),C={data:null,response:g,request:u};if(b==="json"||b==="text"){const U=await g.text(),Ie=(a=u.jsonParser)!=null?a:pe;C.data=await Ie(U)}else C.data=await g[b]();u?.output&&u.output&&!u.disableValidation&&(C.data=await J(u.output,C.data));for(const U of c.onSuccess)U&&await U(A(P({},C),{response:(o=t?.hookOptions)!=null&&o.cloneResponse?g.clone():g}));return t?.throw?C.data:{data:C.data,error:null}}const Ae=(f=t?.jsonParser)!=null?f:pe,z=await g.text(),ce=Rt(z),Y=ce?await Ae(z):null,Le={response:g,responseText:z,request:u,error:A(P({},Y),{status:g.status,statusText:g.statusText})};for(const _ of c.onError)_&&await _(A(P({},Le),{response:(i=t?.hookOptions)!=null&&i.cloneResponse?g.clone():g}));if(t?.retry){const _=yt(t.retry),b=(l=t.retryAttempt)!=null?l:0;if(await _.shouldAttemptRetry(b,g)){for(const U of c.onRetry)U&&await U(ae);const C=_.getDelay(b);return await new Promise(U=>setTimeout(U,C)),await oe(e,A(P({},t),{retryAttempt:b+1}))}}if(t?.throw)throw new gt(g.status,g.statusText,ce?Y:z);return{data:null,error:A(P({},Y),{status:g.status,statusText:g.statusText})}};const Ut=(e,t)=>{const n="credentials"in Request.prototype,r=je(e?.baseURL,e?.basePath)??"/api/auth",s=e?.plugins?.flatMap(u=>u.fetchPlugins).filter(u=>u!==void 0)||[],a={id:"lifecycle-hooks",name:"lifecycle-hooks",hooks:{onSuccess:e?.fetchOptions?.onSuccess,onError:e?.fetchOptions?.onError,onRequest:e?.fetchOptions?.onRequest,onResponse:e?.fetchOptions?.onResponse}},{onSuccess:o,onError:f,onRequest:i,onResponse:l,...c}=e?.fetchOptions||{},d=It({baseURL:r,...n?{credentials:"include"}:{},method:"GET",jsonParser(u){return u?Xe(u,{strict:!1}):null},customFetchImpl:fetch,...c,plugins:[a,...c.plugins||[],...e?.disableDefaultFetchPlugins?[]:[ze],...s]}),{$sessionSignal:h,session:v}=ct(d,e),O=e?.plugins||[];let x={},w={$sessionSignal:h,session:v},M={"/sign-out":"POST","/revoke-sessions":"POST","/revoke-other-sessions":"POST","/delete-user":"POST"};const p=[{signal:"$sessionSignal",matcher(u){return u==="/sign-out"||u==="/update-user"||u==="/sign-up/email"||u==="/sign-in/email"||u==="/delete-user"||u==="/verify-email"||u==="/revoke-sessions"||u==="/revoke-session"||u==="/change-email"}}];for(const u of O)u.getAtoms&&Object.assign(w,u.getAtoms?.(d)),u.pathMethods&&Object.assign(M,u.pathMethods),u.atomListeners&&p.push(...u.atomListeners);const R={notify:u=>{w[u].set(!w[u].get())},listen:(u,$)=>{w[u].subscribe($)},atoms:w};for(const u of O)u.getActions&&Object.assign(x,u.getActions?.(d,R,e));return{get baseURL(){return r},pluginsActions:x,pluginsAtoms:w,pluginPathMethods:M,atomListeners:p,$fetch:d,$store:R}};function xt(e){return typeof e=="object"&&e!==null&&"get"in e&&typeof e.get=="function"&&"lc"in e&&typeof e.lc=="number"}function Mt(e,t,n){const r=t[e],{fetchOptions:s,query:a,...o}=n||{};return r||(s?.method?s.method:o&&Object.keys(o).length>0?"POST":"GET")}function Nt(e,t,n,r,s){function a(o=[]){return new Proxy(function(){},{get(f,i){if(typeof i!="string"||i==="then"||i==="catch"||i==="finally")return;const l=[...o,i];let c=e;for(const d of l)if(c&&typeof c=="object"&&d in c)c=c[d];else{c=void 0;break}return typeof c=="function"||xt(c)?c:a(l)},apply:async(f,i,l)=>{const c="/"+o.map(p=>p.replace(/[A-Z]/g,R=>`-${R.toLowerCase()}`)).join("/"),d=l[0]||{},h=l[1]||{},{query:v,fetchOptions:O,...x}=d,w={...h,...O},M=Mt(c,n,d);return await t(c,{...w,body:M==="GET"?void 0:{...x,...w?.body||{}},query:v||w?.query,method:M,async onSuccess(p){if(await w?.onSuccess?.(p),!s||w.disableSignal)return;const R=s.filter(u=>u.matcher(c));if(R.length)for(const u of R){const $=r[u.signal];if(!$)return;const g=$.get();setTimeout(()=>{$.set(!g)},10)}}})}})}return a()}function $t(e,t={}){let n=X.useRef(e.get());const{keys:r,deps:s=[e,r]}=t;let a=X.useCallback(f=>{const i=l=>{n.current!==l&&(n.current=l,f())};return i(e.value),r?.length?et(e,r,i):e.listen(i)},s),o=()=>n.current;return X.useSyncExternalStore(a,o,o)}function Bt(e){return`use${Fe(e)}`}function qt(e){const{pluginPathMethods:t,pluginsActions:n,pluginsAtoms:r,$fetch:s,$store:a,atomListeners:o}=Ut(e);let f={};for(const[i,l]of Object.entries(r))f[Bt(i)]=()=>$t(l);return Nt({...n,...f,$fetch:s,$store:a},s,t,r,o)}function Ft(e){return{authorize(t,n="AND"){let r=!1;for(const[s,a]of Object.entries(t)){const o=e[s];if(!o)return{success:!1,error:`You are not allowed to access resource: ${s}`};if(Array.isArray(a))r=a.every(f=>o.includes(f));else if(typeof a=="object"){const f=a;f.connector==="OR"?r=f.actions.some(i=>o.includes(i)):r=f.actions.every(i=>o.includes(i))}else throw new j("Invalid access control request");if(r&&n==="OR")return{success:r};if(!r&&n==="AND")return{success:!1,error:`unauthorized to access resource "${s}"`}}return r?{success:r}:{success:!1,error:"Not authorized"}},statements:e}}function Re(e){return{newRole(t){return Ft(t)},statements:e}}const kt={user:["create","list","set-role","ban","impersonate","delete","set-password","get","update"],session:["list","revoke","delete"]},Oe=Re(kt),Se=Oe.newRole({user:["create","list","set-role","ban","impersonate","delete","set-password","get","update"],session:["list","revoke","delete"]}),_e=Oe.newRole({user:[],session:[]}),Dt={admin:Se,user:_e},jt=e=>{if(e.userId&&e.options?.adminUserIds?.includes(e.userId))return!0;if(!e.permissions&&!e.permission)return!1;const t=(e.role||e.options?.defaultRole||"user").split(","),n=e.options?.roles||Dt;for(const r of t)if(n[r]?.authorize(e.permission??e.permissions)?.success)return!0;return!1},zt=e=>{const t={admin:Se,user:_e,...e?.roles};return{id:"admin-client",$InferServerPlugin:{},getActions:()=>({admin:{checkRolePermission:n=>jt({role:n.role,options:{ac:e?.ac,roles:t},permissions:n.permissions??n.permission})}}),pathMethods:{"/admin/list-users":"GET","/admin/stop-impersonating":"POST"}}},Gt={organization:["update","delete"],member:["create","update","delete"],invitation:["create","cancel"],team:["create","update","delete"],ac:["create","read","update","delete"]},ie=Re(Gt),Ee=ie.newRole({organization:["update"],invitation:["create","cancel"],member:["create","update","delete"],team:["create","update","delete"],ac:["create","read","update","delete"]}),Te=ie.newRole({organization:["update","delete"],member:["create","update","delete"],invitation:["create","cancel"],team:["create","update","delete"],ac:["create","read","update","delete"]}),Pe=ie.newRole({organization:[],member:[],invitation:[],team:[],ac:["read"]}),Vt={admin:Ee,owner:Te,member:Pe},Wt=(e,t)=>{if(!e.permissions&&!e.permission)return!1;const n=e.role.split(","),r=e.options.creatorRole||"owner",s=n.includes(r),a=e.allowCreatorAllPermissions||!1;if(s&&a)return!0;for(const o of n)if(t[o]?.authorize(e.permissions??e.permission)?.success)return!0;return!1},Ht=e=>Wt(e,e.options.roles||Vt),Jt=e=>{const t=q(!1),n=q(!1),r=q(!1),s=q(!1),a={admin:Ee,member:Pe,owner:Te,...e?.roles};return{id:"organization",$InferServerPlugin:{},getActions:(o,f,i)=>({$Infer:{ActiveOrganization:{},Organization:{},Invitation:{},Member:{},Team:{}},organization:{checkRolePermission:l=>Ht({role:l.role,options:{ac:e?.ac,roles:a},permissions:l.permissions??l.permission})}}),getAtoms:o=>{const f=D(t,"/organization/list",o,{method:"GET"});return{$listOrg:t,$activeOrgSignal:n,$activeMemberSignal:r,$activeMemberRoleSignal:s,activeOrganization:D([n],"/organization/get-full-organization",o,()=>({method:"GET"})),listOrganizations:f,activeMember:D([r],"/organization/get-active-member",o,{method:"GET"}),activeMemberRole:D([s],"/organization/get-active-member-role",o,{method:"GET"})}},pathMethods:{"/organization/get-full-organization":"GET","/organization/list-user-teams":"GET"},atomListeners:[{matcher(o){return o==="/organization/create"||o==="/organization/delete"||o==="/organization/update"},signal:"$listOrg"},{matcher(o){return o.startsWith("/organization")},signal:"$activeOrgSignal"},{matcher(o){return o.startsWith("/organization/set-active")},signal:"$sessionSignal"},{matcher(o){return o.includes("/organization/update-member-role")},signal:"$activeMemberSignal"},{matcher(o){return o.includes("/organization/update-member-role")},signal:"$activeMemberRoleSignal"}]}},{useSession:Xt,signIn:Qt,signOut:Zt,signUp:Kt,getSession:en,admin:tn}=qt({redirectTo:"/manage",plugins:[zt(),Jt()]});export{Zt as a,Qt as s,Xt as u};
